<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">

<title>üå± RABANITO ‚Äì Dashboard Moderno</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: 'Poppins', sans-serif;
  margin: 0; padding: 0;
  background: #d7ffe0;
  overflow-x: hidden;
}

/* Fondo suave animado */
#fondo {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle, rgba(255,255,255,0.6), rgba(180,255,200,0.3));
  animation: brillo 6s infinite alternate;
  z-index: -1;
}
@keyframes brillo {
  from { filter: brightness(1); }
  to   { filter: brightness(1.12); }
}

/* Men√∫ lateral */
#menu {
  position: fixed; top: 0; left: 0;
  width: 260px; height: 100%;
  background: rgba(255,255,255,0.97);
  transform: translateX(-260px);
  transition: 0.3s;
  box-shadow: 4px 0px 20px rgba(0,0,0,0.1);
  backdrop-filter: blur(8px);
  z-index: 20;
}
#menu.open { transform: translateX(0); }

#menu h2 {
  font-size: 24px;
  padding: 20px;
  text-align: center;
  color: #27ae60;
}

.menuBtn {
  padding: 15px 20px;
  font-size: 17px;
  border-bottom: 1px solid #ececec;
  cursor: pointer;
  transition: 0.2s;
}
.menuBtn:hover {
  background: #e7ffe9;
}

/* Bot√≥n men√∫ */
#toggleMenu {
  position: fixed;
  top: 15px; left: 15px;
  background: #27ae60;
  color: white;
  font-size: 24px;
  padding: 12px 15px;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
  z-index: 21;
}

/* T√≠tulo */
header {
  text-align: center;
  padding: 30px;
  font-size: 32px;
  font-weight: 700;
  color: white;
  background: linear-gradient(90deg, #2ecc71, #27ae60);
  margin-bottom: 15px;
  animation: fadeDown 1s;
}
@keyframes fadeDown{
  from { opacity:0; transform:translateY(-20px);}
  to   { opacity:1; transform:translateY(0);}
}

/* Contenedor */
#contenedor {
  width: 90%;
  margin: auto;
}

/* Tarjetas */
.card {
  background: white;
  padding: 22px;
  border-radius: 18px;
  margin-bottom: 20px;
  font-size: 22px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  transition: 0.25s;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.valor {
  font-weight: 700;
  color: #27ae60;
  font-size: 26px;
}

/* Estado */
#estadoPlanta {
  background: #e3faff;
  padding: 20px;
  border-radius: 20px;
  text-align:center;
  font-size: 26px;
  font-weight: 700;
  margin-top: 25px;
}

/* Gr√°fica */
.graficaBox {
  background: white;
  padding: 20px;
  border-radius: 20px;
  margin-top: 30px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}
</style>
</head>

<body>

<div id="fondo"></div>

<div id="toggleMenu">‚ò∞</div>

<div id="menu">
  <h2>üåø Men√∫</h2>

  <div class="menuBtn" onclick="modoClaro()">üåû Tema Claro</div>
  <div class="menuBtn" onclick="modoOscuro()">üåô Tema Oscuro</div>

  <div class="menuBtn" onclick="simular('seca')">üíß Simular: Falta agua</div>
  <div class="menuBtn" onclick="simular('inundada')">‚ö†Ô∏è Simular: Demasiada agua</div>
  <div class="menuBtn" onclick="simular('luz')">‚òÄÔ∏è Simular: Mucha luz</div>
  <div class="menuBtn" onclick="simular('poca_luz')">üåë Simular: Poca luz</div>
  <div class="menuBtn" onclick="simular('normal')">üå± Simular: Normal</div>
</div>

<header>üå± RABANITO ‚Äì Dashboard Moderno</header>

<div id="contenedor">

  <div class="card">üå° Temperatura: <span class="valor" id="temp">--</span> ¬∞C</div>
  <div class="card">üíß Humedad Ambiental: <span class="valor" id="hum">--</span> %</div>
  <div class="card">üå± Humedad del Suelo: <span class="valor" id="suelo">--</span> %</div>
  <div class="card">üîÜ Luz: <span class="valor" id="luz">--</span></div>

  <div id="estadoPlanta">Estado: ---</div>

  <div class="graficaBox">
    <h2 style="text-align:center;">üìà Historial</h2>
    <canvas id="graficoPlanta" height="100"></canvas>
  </div>

</div>

<script>
/* ===================================================
   CONFIGURACI√ìN ‚Äì IP REAL DEL ESP32
   =================================================== */
const ESP32_URL = "http://192.168.100.50/datos";

/* ===================================================
   GR√ÅFICO
   =================================================== */
const ctx = document.getElementById("graficoPlanta").getContext("2d");

let chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [
      { label:"Temperatura", borderColor:"#e74c3c", backgroundColor:"rgba(231,76,60,0.2)", data:[] },
      { label:"Humedad", borderColor:"#3498db", backgroundColor:"rgba(52,152,219,0.2)", data:[] },
      { label:"Suelo", borderColor:"#27ae60", backgroundColor:"rgba(46,204,113,0.2)", data:[] },
      { label:"Luz", borderColor:"#f1c40f", backgroundColor:"rgba(241,196,15,0.2)", data:[] }
    ]
  },
  options: { scales: { y: { beginAtZero: true } } }
});

function actualizarGrafico(data) {
  let h = new Date().toLocaleTimeString();
  chart.data.labels.push(h);

  chart.data.datasets[0].data.push(data.temperatura);
  chart.data.datasets[1].data.push(data.humedad);
  chart.data.datasets[2].data.push(data.humedad_suelo);
  chart.data.datasets[3].data.push(data.luz);

  if(chart.data.labels.length > 20){
    chart.data.labels.shift();
    chart.data.datasets.forEach(d => d.data.shift());
  }

  chart.update();
}

/* ===================================================
   ESTADO AUTOM√ÅTICO
   =================================================== */
function evaluarEstado(d){
  let estado = "";

  if (d.humedad_suelo < 30) estado = "üíß Falta agua";
  else if (d.humedad_suelo > 90) estado = "‚ö†Ô∏è Demasiada agua";
  else if (d.luz < 20) estado = "üåë Muy poca luz";
  else if (d.luz > 900) estado = "‚òÄÔ∏è Mucha luz";
  else estado = "üå± Saludable";

  document.getElementById("estadoPlanta").innerText = "Estado: " + estado;
}

/* ===================================================
   LECTURA DEL ESP32
   =================================================== */
async function actualizarDatos(){
  try{
    const res = await fetch(ESP32_URL);
    const data = await res.json();

    document.getElementById("temp").innerText  = data.temperatura;
    document.getElementById("hum").innerText   = data.humedad;
    document.getElementById("suelo").innerText = data.humedad_suelo;
    document.getElementById("luz").innerText   = data.luz;

    evaluarEstado(data);
    actualizarGrafico(data);

  } catch(e){ console.log(e); }
}

/* ===================================================
   SIMULADOR
   =================================================== */
function simular(tipo){
  let texto="";

  if(tipo==="seca") texto="üíß Falta agua";
  if(tipo==="inundada") texto="‚ö†Ô∏è Demasiada agua";
  if(tipo==="luz") texto="‚òÄÔ∏è Mucha luz";
  if(tipo==="poca_luz") texto="üåë Muy poca luz";
  if(tipo==="normal") texto="üå± Saludable";

  document.getElementById("estadoPlanta").innerText = "Estado: "+texto;
}

/* ===================================================
   TEMAS
   =================================================== */
function modoOscuro(){
  document.body.style.background="#0e1f16";
  document.querySelector("header").style.background="linear-gradient(90deg,#1b4332,#081c15)";
}
function modoClaro(){
  document.body.style.background="#d7ffe0";
  document.querySelector("header").style.background="linear-gradient(90deg,#2ecc71,#27ae60)";
}

/* ===================================================
   MEN√ö
   =================================================== */
document.getElementById("toggleMenu").onclick = () => {
  document.getElementById("menu").classList.toggle("open");
};

/* ===================================================
   LOOP AUTOM√ÅTICO
   =================================================== */
setInterval(actualizarDatos, 3000);
actualizarDatos();

</script>
</body>
</html>
